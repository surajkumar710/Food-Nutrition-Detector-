RECOMMENDATION_DB = {
    # Rice Dishes
    "biryani": {
        "diabetes": [
            "Limit portion to 1 cup (200g)",
            "Pair with cucumber raita to slow carb absorption",
            "Choose brown rice version if available",
            "Avoid fried toppings like crispy onions"
        ],
        "hypertension": [
            "Request less salt in preparation",
            "Avoid pickles which are high in sodium",
            "Opt for vegetable biryani over meat versions",
            "Limit intake of biryani masala which is high in salt"
        ],
        "weightloss": [
            "Opt for vegetable biryani instead",
            "Limit portion to 3/4 cup (150g)",
            "Skip the accompanying raita to reduce calories",
            "Choose dum biryani over fried versions"
        ],
        "general": [
            "Balance with a protein side dish",
            "Contains 350-400 calories per serving",
            "The saffron contains antioxidants",
            "Pair with salad for added fiber"
        ]
    },
    "pulao": {
        "diabetes": [
            "Limit portion to 3/4 cup (150g)",
            "Add protein like boiled eggs or paneer",
            "Choose vegetable pulao over meat versions",
            "Pair with yogurt to lower glycemic index"
        ],
        "hypertension": [
            "Request less salt in preparation",
            "Avoid packaged pulao masalas",
            "Add potassium-rich vegetables like spinach"
        ],
        "weightloss": [
            "Measure portion size carefully",
            "Use less oil in preparation",
            "Add extra vegetables to increase volume"
        ],
        "general": [
            "Vegetable pulao provides fiber",
            "Contains 250-300 calories per serving",
            "The ghee used aids nutrient absorption",
            "Good source of complex carbohydrates"
        ]
    },
    "jeera rice": {
        "diabetes": [
            "Limit to 1/2 cup portion",
            "Pair with dal for complete protein",
            "Add vegetables to increase fiber"
        ],
        "hypertension": [
            "Prepare with minimal salt",
            "Avoid pairing with high-sodium pickles"
        ],
        "weightloss": [
            "Measure portion size (1/2 cup = 100 cal)",
            "Use less ghee in preparation"
        ],
        "general": [
            "Cumin aids digestion",
            "Light and easy to digest",
            "Good post-illness recovery food"
        ]
    },

    # Breads
    "roti": {
        "diabetes": [
            "Limit to 2 pieces per meal",
            "Pair with protein-rich dal",
            "Choose multigrain versions",
            "Avoid ghee topping"
        ],
        "hypertension": [
            "Avoid pairing with high-sodium curries",
            "Whole wheat provides potassium"
        ],
        "weightloss": [
            "Use multigrain atta for more fiber",
            "1 roti = ~70 calories",
            "Count as 1 carb serving"
        ],
        "general": [
            "Whole wheat provides complex carbs",
            "Good source of dietary fiber",
            "Phulkas are lighter than rotis",
            "Contains B vitamins from whole wheat"
        ]
    },
    "naan": {
        "diabetes": [
            "Limit to 1 piece per meal",
            "Avoid butter topping",
            "Pair with protein-rich curry",
            "Choose smaller size if available"
        ],
        "hypertension": [
            "Request less salt in dough",
            "Avoid garlic naan (higher sodium)"
        ],
        "weightloss": [
            "Contains 300+ calories per piece",
            "Choose tandoori roti instead",
            "Share one naan between two people"
        ],
        "general": [
            "Tandoor cooking preserves nutrients",
            "Yogurt in dough adds probiotics",
            "Best enjoyed fresh from tandoor"
        ]
    },
    "paratha": {
        "diabetes": [
            "Limit to 1 small paratha",
            "Choose vegetable-stuffed versions",
            "Avoid white flour parathas"
        ],
        "hypertension": [
            "Avoid pickles as accompaniment",
            "Request less salt in dough"
        ],
        "weightloss": [
            "High in calories (280+ per piece)",
            "Opt for roti instead",
            "Use minimal oil for cooking"
        ],
        "general": [
            "Aloo paratha provides energy",
            "Methi paratha has blood sugar benefits",
            "Good travel food as it stays fresh"
        ]
    },

    # South Indian
    "dosa": {
        "diabetes": [
            "Choose sambar over coconut chutney",
            "Limit to 1 dosa per meal",
            "Opt for ragi or multigrain dosa",
            "Pair with protein-rich chutney"
        ],
        "hypertension": [
            "Avoid overly salty chutneys",
            "Request less salt in batter"
        ],
        "weightloss": [
            "Plain dosa is lower calorie",
            "Avoid ghee roast versions",
            "1 dosa = ~150 calories"
        ],
        "general": [
            "Fermented food helps digestion",
            "Good source of carbohydrates",
            "Urad dal provides protein",
            "Naturally gluten-free"
        ]
    },
    "idli": {
        "diabetes": [
            "2 idlis = 1 carb serving",
            "Pair with protein-rich sambar",
            "Choose ragi or oats idli variants"
        ],
        "hypertension": [
            "Avoid coconut chutney daily",
            "Request less salt in batter"
        ],
        "weightloss": [
            "Low-calorie option (60 cal each)",
            "Avoid fried accompaniments",
            "Steamed preparation is healthy"
        ],
        "general": [
            "Easy to digest breakfast option",
            "Fermentation increases nutrient availability",
            "Good weaning food for babies"
        ]
    },
    "vada": {
        "diabetes": [
            "Limit to 1 piece occasionally",
            "Pair with protein-rich sambar",
            "Avoid coconut chutney"
        ],
        "hypertension": [
            "High in sodium - limit intake",
            "Avoid fried versions"
        ],
        "weightloss": [
            "High in calories (140 each)",
            "Opt for steamed versions if available",
            "Consider as occasional treat"
        ],
        "general": [
            "Urad dal provides protein",
            "Crispy texture is satisfying",
            "Traditional festival food"
        ]
    },

    # Curries
    "butter chicken": {
        "diabetes": [
            "Limit gravy portion due to sugar content",
            "Remove skin from chicken",
            "Pair with roti instead of naan",
            "Avoid cream-heavy versions"
        ],
        "hypertension": [
            "High in sodium - limit portion",
            "Request less salt in preparation"
        ],
        "weightloss": [
            "High in calories (450+ per serving)",
            "Choose tandoori chicken instead",
            "Skip the butter topping",
            "Measure portion carefully"
        ],
        "general": [
            "Good source of protein",
            "Tomatoes provide lycopene",
            "Best enjoyed occasionally"
        ]
    },
    "palak paneer": {
        "diabetes": [
            "Pair with roti instead of naan",
            "Paneer provides slow-digesting protein",
            "Spinach has blood sugar benefits"
        ],
        "hypertension": [
            "Request less salt in preparation",
            "Spinach provides potassium"
        ],
        "weightloss": [
            "Measure paneer portion (30g per serving)",
            "Use less oil in preparation",
            "High-protein vegetarian option"
        ],
        "general": [
            "Excellent source of iron from spinach",
            "Paneer provides quality protein",
            "Good calcium source",
            "Combines greens with dairy"
        ]
    },
    "chana masala": {
        "diabetes": [
            "Excellent plant-based protein",
            "Chickpeas have low glycemic index",
            "Pair with roti for balanced meal"
        ],
        "hypertension": [
            "Request less salt in preparation",
            "Chickpeas provide potassium"
        ],
        "weightloss": [
            "High fiber keeps you full",
            "Measure portion (1 cup cooked)",
            "Use less oil in preparation"
        ],
        "general": [
            "Vegetarian protein powerhouse",
            "Good source of dietary fiber",
            "Contains iron and folate",
            "Budget-friendly nutritious food"
        ]
    },

    # Snacks
    "samosa": {
        "diabetes": [
            "Limit to 1 small piece occasionally",
            "Avoid potato stuffing versions",
            "Pair with protein-rich dip"
        ],
        "hypertension": [
            "High in sodium - avoid",
            "Fried food affects blood pressure"
        ],
        "weightloss": [
            "High in calories (260 each)",
            "Consider baked versions if available",
            "Best avoided during weight loss"
        ],
        "general": [
            "Enjoy as occasional treat",
            "Whole wheat versions are healthier",
            "Traditional tea-time snack"
        ]
    },
    "pakora": {
        "diabetes": [
            "Limit portion to 2-3 pieces",
            "Choose vegetable over potato versions",
            "Pair with protein-rich dip"
        ],
        "hypertension": [
            "High in sodium - limit intake",
            "Fried food affects blood pressure"
        ],
        "weightloss": [
            "High in calories (180 per serving)",
            "Consider air-fried versions",
            "Best avoided during weight loss"
        ],
        "general": [
            "Monsoon favorite snack",
            "Besan provides some protein",
            "Enjoy occasionally in moderation"
        ]
    },
    "bhel puri": {
        "diabetes": [
            "Limit portion to 1 small cup",
            "Request less chutneys (high sugar)",
            "Add sprouts for protein"
        ],
        "hypertension": [
            "Request less salt and chutneys",
            "Avoid packaged sev (high sodium)"
        ],
        "weightloss": [
            "Measure portion carefully",
            "Opt for homemade versions",
            "1 cup = ~200 calories"
        ],
        "general": [
            "Contains healthy puffed rice",
            "Vegetables provide fiber",
            "Street food favorite"
        ]
    },

    # Sweets
    "gulab jamun": {
        "diabetes": [
            "Best avoided or tiny portion",
            "Check blood sugar after eating",
            "Avoid syrup-soaked pieces"
        ],
        "hypertension": [
            "High in sugar - limit intake",
            "Can affect blood pressure"
        ],
        "weightloss": [
            "High in calories (150 each)",
            "Consider as rare treat",
            "Share one piece between two"
        ],
        "general": [
            "Enjoy in small portions",
            "Festival special sweet",
            "Contains milk solids nutrition"
        ]
    },
    "jalebi": {
        "diabetes": [
            "Best avoided completely",
            "Extremely high in sugar",
            "Causes blood sugar spikes"
        ],
        "hypertension": [
            "High sugar affects blood pressure",
            "Best avoided"
        ],
        "weightloss": [
            "Very high in calories (180 each)",
            "Not recommended during weight loss",
            "One piece can undo a workout"
        ],
        "general": [
            "Traditional festival sweet",
            "Enjoy very occasionally",
            "Pair with milk to slow absorption"
        ]
    },
    "rasgulla": {
        "diabetes": [
            "Limit to 1 small piece",
            "Avoid drinking the syrup",
            "Check blood sugar after"
        ],
        "hypertension": [
            "High in sugar - limit intake",
            "Can affect blood pressure"
        ],
        "weightloss": [
            "High in calories (120 each)",
            "Consider as occasional treat",
            "Measure portion carefully"
        ],
        "general": [
            "Contains milk protein",
            "Bengali specialty sweet",
            "Lighter than many Indian sweets"
        ]
    },

    # Street Food
    "pani puri": {
        "diabetes": [
            "Limit to 3-4 pieces",
            "Request less sweet chutney",
            "Avoid potato stuffing"
        ],
        "hypertension": [
            "High in sodium - limit intake",
            "Avoid extra masala toppings"
        ],
        "weightloss": [
            "1 plate = ~100 calories",
            "Water helps fill you up",
            "Measure portion carefully"
        ],
        "general": [
            "Tangy flavor satisfies cravings",
            "Contains some digestive spices",
            "Popular street food"
        ]
    },
    "pav bhaji": {
        "diabetes": [
            "Limit pav (bread) portion",
            "Extra vegetables increase fiber",
            "Pair with protein source"
        ],
        "hypertension": [
            "Request less salt in bhaji",
            "Avoid extra butter topping"
        ],
        "weightloss": [
            "High in calories (350 per serving)",
            "Measure butter quantity",
            "Opt for less pav more bhaji"
        ],
        "general": [
            "Vegetable-packed meal",
            "Contains antioxidant spices",
            "Mumbai street food favorite"
        ]
    },
    "dahi puri": {
        "diabetes": [
            "Limit to 3-4 pieces",
            "Request less sweet chutney",
            "Yogurt helps slow digestion"
        ],
        "hypertension": [
            "High in sodium - limit intake",
            "Avoid extra masala toppings"
        ],
        "weightloss": [
            "1 plate = ~150 calories",
            "Yogurt provides protein",
            "Measure portion carefully"
        ],
        "general": [
            "Probiotics from dahi (yogurt)",
            "Cooling summer snack",
            "Popular chaat variety"
        ]
    },

    # Healthy Options
    "dal khichdi": {
        "diabetes": [
            "Good low-GI meal option",
            "Contains complete protein from dal+rice",
            "Pair with yogurt for probiotics"
        ],
        "hypertension": [
            "Prepare with less salt",
            "Dal provides potassium"
        ],
        "weightloss": [
            "Portion-controlled one-pot meal",
            "High fiber keeps you full",
            "Use less ghee in preparation"
        ],
        "general": [
            "Easy to digest comfort food",
            "Balanced carb-protein ratio",
            "Ayurvedic healing food",
            "Good convalescence diet"
        ]
    },
    "sambar rice": {
        "diabetes": [
            "Dal provides plant protein",
            "Vegetables increase fiber",
            "Pair with buttermilk"
        ],
        "hypertension": [
            "Request less salt in sambar",
            "Vegetables provide potassium"
        ],
        "weightloss": [
            "Measure rice portion",
            "Vegetable-heavy versions best",
            "1 cup = ~180 calories"
        ],
        "general": [
            "Complete vegetarian protein",
            "Tamarind aids digestion",
            "South Indian staple"
        ]
    },
    "kitchari": {
        "diabetes": [
            "Balanced carb-protein ratio",
            "Mung dal is easy to digest",
            "Good for detox diets"
        ],
        "hypertension": [
            "Prepare with less salt",
            "Herbs support circulation"
        ],
        "weightloss": [
            "Light yet satisfying",
            "Use minimal ghee",
            "Good for intermittent fasting"
        ],
        "general": [
            "Ayurvedic cleansing food",
            "Balances all doshas",
            "Good during illness recovery"
        ]
    },

    # Regional Specialties
    "rogan josh": {
        "diabetes": [
            "Remove visible fat",
            "Pair with roti instead of rice",
            "Limit portion due to oil content"
        ],
        "hypertension": [
            "High in sodium - limit intake",
            "Request less salt in preparation"
        ],
        "weightloss": [
            "High in calories (380 per serving)",
            "Measure portion carefully",
            "Remove fat layer before eating"
        ],
        "general": [
            "Rich in iron from meat",
            "Kashmiri specialty",
            "Contains anti-inflammatory spices"
        ]
    },
    "dhokla": {
        "diabetes": [
            "Good steamed snack option",
            "Besan provides protein",
            "Pair with mint chutney"
        ],
        "hypertension": [
            "Request less salt in batter",
            "Avoid fried versions"
        ],
        "weightloss": [
            "Low-calorie snack (120 each)",
            "Steamed preparation is healthy",
            "Good tea-time option"
        ],
        "general": [
            "Probiotic benefits from fermentation",
            "Gujarati specialty",
            "Gluten-free snack"
        ]
    },
    "misal pav": {
        "diabetes": [
            "Limit pav (bread) portion",
            "Sprouts provide plant protein",
            "Request less sweet chutney"
        ],
        "hypertension": [
            "Request less salt in usal",
            "Avoid extra farsan toppings"
        ],
        "weightloss": [
            "High in calories (300 per serving)",
            "Measure portion carefully",
            "Opt for less pav more usal"
        ],
        "general": [
            "Protein-packed meal",
            "Maharashtrian specialty",
            "Spicy flavor satisfies cravings"
        ]
    },

    # Default recommendations
    "default": {
        "diabetes": [
            "Monitor carbohydrate intake",
            "Pair carbs with protein/fiber",
            "Choose low glycemic index foods",
            "Eat at regular intervals",
            "Check blood sugar after new foods"
        ],
        "hypertension": [
            "Watch sodium content",
            "Limit pickles and papads",
            "Increase potassium-rich foods",
            "Practice mindful eating",
            "Limit processed foods"
        ],
        "weightloss": [
            "Be mindful of portion sizes",
            "Chew slowly and stop when 80% full",
            "Focus on protein and fiber",
            "Stay hydrated",
            "Regular physical activity is key"
        ],
        "general": [
            "Enjoy your meal in moderation",
            "Balance with vegetables",
            "Stay hydrated",
            "Practice mindful eating",
            "Variety ensures complete nutrition"
        ]
    }
}

def get_recommendations(food_name, health_condition='general'):
    """Get personalized nutrition recommendations with enhanced matching"""
    food_lower = food_name.lower()
    recommendations = []
    
    # Find all matching food keys (for partial matches)
    matching_foods = [key for key in RECOMMENDATION_DB if key in food_lower and key != "default"]
    
    if matching_foods:
        # Get recommendations for all matching foods
        for food_key in matching_foods:
            food_data = RECOMMENDATION_DB[food_key]
            if health_condition in food_data:
                recommendations.extend(food_data[health_condition])
            if 'general' in food_data:
                recommendations.extend(food_data['general'])
    else:
        # Use default recommendations if no specific match found
        default_data = RECOMMENDATION_DB["default"]
        recommendations.extend(default_data.get(health_condition, []))
        recommendations.extend(default_data.get('general', []))
    
    # Remove duplicates while preserving order
    seen = set()
    unique_recommendations = []
    for rec in recommendations:
        if rec not in seen:
            seen.add(rec)
            unique_recommendations.append(rec)
    
    return unique_recommendations[:7]  # Return top 7 most relevant recommendations
